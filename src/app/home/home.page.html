<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="renomearLista()">
        <ion-icon slot="icon-only" name="create-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>
      {{ nomeLista }}
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="limparTudo()" [disabled]="lista.length === 0">
        <ion-icon slot="start" name="trash-outline"></ion-icon>
        Limpar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- Filtros -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Filtros</ion-card-title>
    </ion-card-header>

        <ion-card-content>
      <!-- ðŸ†• SeleÃ§Ã£o de lista + botÃ£o criar -->
      <ion-item>
        <ion-label>Lista</ion-label>
        <ion-select
          [(ngModel)]="listaSelecionadaId"
          interface="popover"
          (ionChange)="trocarLista()">
          <ion-select-option
            *ngFor="let l of listas"
            [value]="l.id">
            {{ l.nome }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-button
        expand="block"
        fill="outline"
        size="small"
        class="ion-margin-bottom"
        (click)="novaLista()">
        <ion-icon slot="start" name="add-outline"></ion-icon>
        Nova lista
      </ion-button>

      <!-- Contadores -->
      <div class="resumo-lista">
        <p>
          Itens: {{ totalItens }} â€¢
          Unidades: {{ totalUnidades }} â€¢
          NÃ£o comprados: {{ totalNaoComprados }} â€¢
          Comprados: {{ totalComprados }}
        </p>
      </div>

      <ion-item>
        <ion-label>Categoria</ion-label>
        <ion-select [(ngModel)]="categoriaFiltro" interface="popover">
          <ion-select-option value="Todas">Todas</ion-select-option>
          <ion-select-option *ngFor="let cat of categorias" [value]="cat">
            {{ cat }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item lines="none">
        <ion-label>Ver apenas nÃ£o comprados</ion-label>
        <ion-toggle [(ngModel)]="mostrarSomenteNaoComprados"></ion-toggle>
      </ion-item>

            <!-- ðŸ†• Modo escuro -->
      <ion-item lines="none">
        <ion-label>Modo escuro</ion-label>
        <ion-toggle
          [(ngModel)]="temaEscuro"
          (ionChange)="alternarTema($event)">
        </ion-toggle>
      </ion-item>

       <!-- ðŸ†• Busca por nome -->
      <ion-item lines="none">
        <ion-label position="stacked">Buscar item</ion-label>
        <ion-searchbar
          [(ngModel)]="termoBusca"
          placeholder="Ex: arroz, leite, carne..."
          debounce="200">
        </ion-searchbar>
      </ion-item>

      <ion-button
        expand="block"
        class="ion-margin-top"
        (click)="compartilharWhatsApp()"
        [disabled]="lista.length === 0">
        <ion-icon slot="start" name="share-social-outline"></ion-icon>
        Compartilhar no WhatsApp
      </ion-button>

      <ion-button
        expand="block"
        class="ion-margin-top"
        (click)="marcarTodosComoComprados()"
        [disabled]="totalNaoComprados === 0">
        <ion-icon slot="start" name="checkmark-done-outline"></ion-icon>
        Marcar todos como comprados
      </ion-button>

      <ion-button
        expand="block"
        class="ion-margin-top"
        color="medium"
        (click)="limparApenasComprados()"
        [disabled]="totalComprados === 0">
        <ion-icon slot="start" name="trash-bin-outline"></ion-icon>
        Remover itens comprados
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- FormulÃ¡rio para adicionar item -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Adicionar item</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Nome do produto</ion-label>
        <ion-input
          [(ngModel)]="novoItemNome"
          (keyup.enter)="adicionar()">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Quantidade</ion-label>
        <ion-input
          type="number"
          min="1"
          [(ngModel)]="novoItemQuantidade"
          (keyup.enter)="adicionar()">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label>Categoria</ion-label>
        <ion-select [(ngModel)]="novaCategoria" interface="popover">
          <ion-select-option *ngFor="let cat of categorias" [value]="cat">
            {{ cat }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Nova categoria</ion-label>
        <ion-input
          [(ngModel)]="novaCategoriaPersonalizada"
          (keyup.enter)="adicionarCategoriaPersonalizada()">
        </ion-input>
      </ion-item>

      <ion-button
        expand="block"
        class="ion-margin-top"
        (click)="adicionarCategoriaPersonalizada()">
        <ion-icon slot="start" name="pricetag-outline"></ion-icon>
        Adicionar categoria
      </ion-button>

      <ion-button
        expand="block"
        class="ion-margin-top"
        (click)="adicionar()">
        <ion-icon slot="start" name="add-circle-outline"></ion-icon>
        Adicionar item
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Lista agrupada por categoria - NÃƒO comprados -->
  <ng-container *ngIf="gruposPorCategoriaNaoComprados.length > 0; else semItens">
    <div *ngFor="let grupo of gruposPorCategoriaNaoComprados" class="grupo-categoria">
      <h2 class="categoria-titulo">{{ grupo.categoria }}</h2>

      <ion-list>
        <ion-item-sliding *ngFor="let item of grupo.itens">
          <ion-item (click)="alternarComprado(item)">
            <ion-checkbox
              slot="start"
              [checked]="item.comprado">
            </ion-checkbox>

            <ion-label>
              <h2 [ngClass]="{ 'comprado': item.comprado }">
                {{ item.nome }}
              </h2>
              <p>Qtd: {{ item.quantidade }}</p>
            </ion-label>
          </ion-item>

                    <ion-item-options side="end">
            <ion-item-option color="primary" (click)="editar(item)">
              <ion-icon slot="start" name="create-outline"></ion-icon>
              Editar
            </ion-item-option>

            <ion-item-option color="danger" (click)="remover(item)">
              <ion-icon slot="start" name="trash-outline"></ion-icon>
              Remover
            </ion-item-option>
          </ion-item-options>

        </ion-item-sliding>
      </ion-list>
    </div>
  </ng-container>

  <!-- SeÃ§Ã£o de COMPRADOS -->
  <ng-container *ngIf="!mostrarSomenteNaoComprados && gruposPorCategoriaComprados.length > 0">
    <h2 class="secao-comprados-titulo">
      <ion-icon name="checkmark-circle-outline"></ion-icon>
      &nbsp;Comprados
    </h2>

    <div *ngFor="let grupo of gruposPorCategoriaComprados" class="grupo-categoria grupo-comprados">
      <h3 class="categoria-titulo">{{ grupo.categoria }}</h3>

      <ion-list>
        <ion-item-sliding *ngFor="let item of grupo.itens">
          <ion-item (click)="alternarComprado(item)">
            <ion-checkbox
              slot="start"
              [checked]="item.comprado">
            </ion-checkbox>

            <ion-label>
              <h2 [ngClass]="{ 'comprado': item.comprado }">
                {{ item.nome }}
              </h2>
              <p>Qtd: {{ item.quantidade }}</p>
            </ion-label>
          </ion-item>

                    <ion-item-options side="end">
            <ion-item-option color="primary" (click)="editar(item)">
              <ion-icon slot="start" name="create-outline"></ion-icon>
              Editar
            </ion-item-option>

            <ion-item-option color="danger" (click)="remover(item)">
              <ion-icon slot="start" name="trash-outline"></ion-icon>
              Remover
            </ion-item-option>
          </ion-item-options>

        </ion-item-sliding>
      </ion-list>
    </div>
  </ng-container>

  <ng-template #semItens>
    <div class="sem-itens">
      <p>Sua lista ainda estÃ¡ vazia. Comece adicionando um item ðŸ˜Š</p>
    </div>
  </ng-template>

</ion-content>
